@model List<Product>

@{
	Layout = "_layout";
	ViewData["Title"] = "Products";
}

<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>CRM Application</title>

	<link rel="stylesheet" type="text/css" href="/css/utils.css">
	<link rel="stylesheet" type="text/css" href="/css/style-table.css">

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/plugins/monthSelect/style.css" />


</head>
<body>
	<h3 style="text-align:center">Products</h3>
	@if (Model.Count > 0)
	{
		<div style="display:flex;justify-content:center">
			<table>
				<thead>
					<tr>
						<th class="main-element">Product</th>
						<th class="centered">Price</th>
						<th class="centered">Type</th>
						<th class="centered">Company</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					@foreach (Product product in Model)
					{
						<tr>
							<td class="centered"><a href="/Product/Product/@product.Id">@product.Name</a></td>
							<td class="centered">@product.Price</td>
							<td class="centered">@product.ProductType!.Name</td>
							<td class="centered"><a href="/Company/Products/@product.Seller!.CompanyId">@product.Seller!.Company!.Name</a></td>
							@if (product.ProductTypeId == 1)
							{


								@using (Html.BeginForm("CreateOrder", "Order", FormMethod.Post))
								{
									<td>
										<input type="hidden" name="product.Id" value="@product.Id" />
										<input type="hidden" name="product.Price" value="@product.Price" />
										<input type="hidden" name="product.ProductTypeId" value="@product.ProductTypeId" />
										<button type="submit" class="load btn_primary mt-3 mb-3">
											Buy
										</button>
									</td>
								}
							}
							else
							{
								<td>
									<button class="btn_primary " data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="endDate">
										Buy
									</button>

									<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
										<div class="modal-dialog">
											<div class="modal-content">
												@using (Html.BeginForm("CreateOrder", "Order", FormMethod.Post))
												{
													<div class="modal-header">
														<h1 class="modal-title fs-5" id="exampleModalLabel">Choose membership end date for @product.Name</h1>
													</div>
													<div style="display:flex;justify-content:center" class="modal-body">

														<input type="hidden" name="product.Id" value="@product.Id" />
														<input type="hidden" name="product.Price" value="@product.Price" />
														<input type="hidden" name="product.ProductTypeId" value="@product.ProductTypeId" />

														<input style="text-align:center;border-radius:30px;padding:12px;width:60%" type="text" name="endDate" id="datetime" placeholder="End Date" />
													</div>
													<div style="justify-content:center" class="modal-footer">
														<button type="submit" class="btn_primary mt-3" style="width:80%;font-size:15px">
															Buy
														</button>
													</div>
												}
											</div>
										</div>
									</div>
								</td>

							}
						</tr>
					}
				</tbody>
			</table>

		</div>
		<br />
		@if (ViewBag.IsAuthorized)
		{
			<div style="display:flex;justify-content:center">
				<a href="/Product/AddProduct" class="btn_primary">Add Product</a>
			</div>
		}
	}
	else
	{
		<h3 style="text-align:center">This company has no products available.</h3>
	}
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
	<script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/plugins/monthSelect/index.js"></script>
	<script>
		flatpickr("#datetime", {
			minDate: "today",
					
			plugins: [
				new monthSelectPlugin({
					shorthand: true, 
					dateFormat: "M/Y", 
					altFormat: "F Y", 
				})
			]
			
		});
	</script>
</body>
</html>
